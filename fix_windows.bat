@echo off
title CVE-2021-44228 Fix Script
echo This script only works if your LOG4J2 version is 2.10 and higher.
echo Setting up... (user-scope)
setx "LOG4J_FORMAT_MSG_NO_LOOKUPS" "true"
echo Getting administrator permission, please click "Yes" in UAC window...
setlocal EnableDelayedExpansion
PUSHD %~DP0 & cd /d "%~dp0"
%1 %2
mshta vbscript:createobject("shell.application").shellexecute("%~s0","goto :runas","","runas",1)(window.close)&goto :eof
:runas
echo Setting up... (system-scope)
setx "LOG4J_FORMAT_MSG_NO_LOOKUPS" "true" /m
echo Done.
pause
